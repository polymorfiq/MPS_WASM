package WebassemblyText.typesystem;

/*Generated by MPS */

import java.util.Deque;
import jetbrains.mps.internal.collections.runtime.DequeSequence;
import java.util.LinkedList;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.internal.collections.runtime.IWhereFilter;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SConceptOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.internal.collections.runtime.IVisitor;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import jetbrains.mps.lang.smodel.EnumerationLiteralsIndex;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SProperty;
import org.jetbrains.mps.openapi.language.SConcept;

public class StackState {
  public Deque<StackItem> currStack;

  public StackState() {
    this.currStack = DequeSequence.fromDequeNew(new LinkedList<StackItem>());
  }

  public void push(SNode id, SNode type) {
    StackItem newItem = new StackItem(id, type);
    DequeSequence.fromDequeNew(this.currStack).pushElement(newItem);
  }

  public StackItem itemAtIndex(SNode index) {
    if ((SLinkOperations.getTarget(index, LINKS.id$PkgV) != null)) {
      return this.itemAtId(SLinkOperations.getTarget(index, LINKS.id$PkgV));
    }

    return this.itemAtIdx(SPropertyOperations.getInteger(SLinkOperations.getTarget(index, LINKS.idx$PjMT), PROPS.value$EujW));
  }

  public StackItem itemAtId(final SNode id) {
    return DequeSequence.fromDequeNew(this.currStack).findFirst(new IWhereFilter<StackItem>() {
      public boolean accept(StackItem item) {
        return SPropertyOperations.getString(item.id, PROPS.name$uQ1W).equals(SPropertyOperations.getString(id, PROPS.name$uQ1W));
      }
    });
  }

  public StackItem itemAtIdx(int idx) {
    int listSize = DequeSequence.fromDequeNew(this.currStack).toListSequence().count();

    if (listSize > idx) {
      return ListSequence.fromList(DequeSequence.fromDequeNew(this.currStack).toListSequence()).getElement(listSize - idx);
    } else {
      return null;
    }
  }

  public static StackState atInstr(SNode instr) {
    SNode curr = instr;
    while ((curr != null)) {
      if (SConceptOperations.isSubConceptOf(SNodeOperations.asSConcept(SNodeOperations.getConcept(SNodeOperations.getParent(SNodeOperations.getParent(curr)))), CONCEPTS.Func$9L)) {
        return StackState.stateAtFuncIndex(SNodeOperations.as(SNodeOperations.getParent(SNodeOperations.getParent(curr)), CONCEPTS.Func$9L), SNodeOperations.getIndexInParent(curr));
      }
      curr = SNodeOperations.getParent(curr);
    }

    return new StackState();
  }

  public static StackState stateAtFuncIndex(SNode fnc, int idx) {
    final StackState state = new StackState();

    ListSequence.fromList(SLinkOperations.getChildren(SLinkOperations.getTarget(fnc, LINKS.typeuse$ss1_), LINKS.params$hnVB)).visitAll(new IVisitor<SNode>() {
      public void visit(SNode param) {
        switch (enumSwitchIndex_x8dabo_a0a0a0a0a0c0o.indexNullable(SPropertyOperations.getEnum(param, PROPS.paramType$CULn))) {
          case 0:
            state.push(SLinkOperations.getTarget(param, LINKS.id$COrW), SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x3ffc45fa71954470L, 0x834ba6b1a95f90d6L, 0x601bfff8ec49ee2bL, "WebassemblyText.structure.I32")));
            break;
          case 1:
            state.push(SLinkOperations.getTarget(param, LINKS.id$COrW), SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x3ffc45fa71954470L, 0x834ba6b1a95f90d6L, 0x601bfff8ec49ee2cL, "WebassemblyText.structure.I64")));
            break;
          case 2:
            state.push(SLinkOperations.getTarget(param, LINKS.id$COrW), SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x3ffc45fa71954470L, 0x834ba6b1a95f90d6L, 0x601bfff8ec49ee2eL, "WebassemblyText.structure.F32")));
            break;
          case 3:
            state.push(SLinkOperations.getTarget(param, LINKS.id$COrW), SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x3ffc45fa71954470L, 0x834ba6b1a95f90d6L, 0x601bfff8ec49ee30L, "WebassemblyText.structure.F64")));
            break;
        }

        return;
      }
    });

    ListSequence.fromList(SLinkOperations.getChildren(fnc, LINKS.locals$$WTv)).visitAll(new IVisitor<SNode>() {
      public void visit(SNode local) {
        switch (enumSwitchIndex_x8dabo_a0a0a0a0a0e0o.indexNullable(SPropertyOperations.getEnum(local, PROPS.type$m6Yv))) {
          case 0:
            state.push(SLinkOperations.getTarget(local, LINKS.id$_qVY), SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x3ffc45fa71954470L, 0x834ba6b1a95f90d6L, 0x601bfff8ec49ee2bL, "WebassemblyText.structure.I32")));
            break;
          case 1:
            state.push(SLinkOperations.getTarget(local, LINKS.id$_qVY), SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x3ffc45fa71954470L, 0x834ba6b1a95f90d6L, 0x601bfff8ec49ee2cL, "WebassemblyText.structure.I64")));
            break;
          case 2:
            state.push(SLinkOperations.getTarget(local, LINKS.id$_qVY), SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x3ffc45fa71954470L, 0x834ba6b1a95f90d6L, 0x601bfff8ec49ee2eL, "WebassemblyText.structure.F32")));
            break;
          case 3:
            state.push(SLinkOperations.getTarget(local, LINKS.id$_qVY), SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x3ffc45fa71954470L, 0x834ba6b1a95f90d6L, 0x601bfff8ec49ee30L, "WebassemblyText.structure.F64")));
            break;
        }
        return;
      }
    });

    return state;
  }

  public StackState clone() {
    StackState newState = new StackState();
    DequeSequence.fromDequeNew(newState.currStack).addSequence(DequeSequence.fromDequeNew(this.currStack));
    return newState;
  }
  private static final EnumerationLiteralsIndex enumSwitchIndex_x8dabo_a0a0a0a0a0c0o = EnumerationLiteralsIndex.build(0x3ffc45fa71954470L, 0x834ba6b1a95f90d6L, 0x601bfff8ed2a9769L, 0x601bfff8ed2a976aL, 0x601bfff8ed2a976cL, 0x601bfff8ed2a9770L, 0x601bfff8ed2a9775L);
  private static final EnumerationLiteralsIndex enumSwitchIndex_x8dabo_a0a0a0a0a0e0o = EnumerationLiteralsIndex.build(0x3ffc45fa71954470L, 0x834ba6b1a95f90d6L, 0x601bfff8ed2a9769L, 0x601bfff8ed2a976aL, 0x601bfff8ed2a976cL, 0x601bfff8ed2a9770L, 0x601bfff8ed2a9775L);

  private static final class LINKS {
    /*package*/ static final SContainmentLink id$PkgV = MetaAdapterFactory.getContainmentLink(0x3ffc45fa71954470L, 0x834ba6b1a95f90d6L, 0x601bfff8ed2b2a4bL, 0x601bfff8ed2b2a56L, "id");
    /*package*/ static final SContainmentLink idx$PjMT = MetaAdapterFactory.getContainmentLink(0x3ffc45fa71954470L, 0x834ba6b1a95f90d6L, 0x601bfff8ed2b2a4bL, 0x601bfff8ed2b2a54L, "idx");
    /*package*/ static final SContainmentLink typeuse$ss1_ = MetaAdapterFactory.getContainmentLink(0x3ffc45fa71954470L, 0x834ba6b1a95f90d6L, 0x601bfff8ec46e659L, 0x601bfff8ed31bf7dL, "typeuse");
    /*package*/ static final SContainmentLink params$hnVB = MetaAdapterFactory.getContainmentLink(0x3ffc45fa71954470L, 0x834ba6b1a95f90d6L, 0x601bfff8ec46e779L, 0x601bfff8ed2b2a7cL, "params");
    /*package*/ static final SContainmentLink id$COrW = MetaAdapterFactory.getContainmentLink(0x3ffc45fa71954470L, 0x834ba6b1a95f90d6L, 0x601bfff8ec46e77dL, 0x601bfff8ec46e77eL, "id");
    /*package*/ static final SContainmentLink locals$$WTv = MetaAdapterFactory.getContainmentLink(0x3ffc45fa71954470L, 0x834ba6b1a95f90d6L, 0x601bfff8ec46e659L, 0x601bfff8ec46e718L, "locals");
    /*package*/ static final SContainmentLink id$_qVY = MetaAdapterFactory.getContainmentLink(0x3ffc45fa71954470L, 0x834ba6b1a95f90d6L, 0x601bfff8ec46e72cL, 0x601bfff8ec46e72fL, "id");
  }

  private static final class PROPS {
    /*package*/ static final SProperty value$EujW = MetaAdapterFactory.getProperty(0x3ffc45fa71954470L, 0x834ba6b1a95f90d6L, 0x601bfff8ed3a988cL, 0x601bfff8ed3a988dL, "value");
    /*package*/ static final SProperty name$uQ1W = MetaAdapterFactory.getProperty(0x3ffc45fa71954470L, 0x834ba6b1a95f90d6L, 0x601bfff8ec46e6a0L, 0x601bfff8ec46e6a1L, "name");
    /*package*/ static final SProperty paramType$CULn = MetaAdapterFactory.getProperty(0x3ffc45fa71954470L, 0x834ba6b1a95f90d6L, 0x601bfff8ec46e77dL, 0x601bfff8ec46e784L, "paramType");
    /*package*/ static final SProperty type$m6Yv = MetaAdapterFactory.getProperty(0x3ffc45fa71954470L, 0x834ba6b1a95f90d6L, 0x601bfff8ec46e72cL, 0x601bfff8ed13e712L, "type");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept Func$9L = MetaAdapterFactory.getConcept(0x3ffc45fa71954470L, 0x834ba6b1a95f90d6L, 0x601bfff8ec46e659L, "WebassemblyText.structure.Func");
  }
}
